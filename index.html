<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Under the Stars Volunteer Roster</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-purple-50 via-pink-50 to-orange-50">
    <div id="app"></div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // --- ðŸ”’ SECURITY WARNING: Replace these with your Supabase credentials ---
        // Your Anon Key is public, so ensure you have Row Level Security (RLS) enabled
        // in your Supabase project to protect your data!
        const SUPABASE_URL = 'https://evhjncobivtsxeeqvlue.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV2aGpuY29iaXZ0c3hlZXF2bHVlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE4MDAyMTUsImV4cCI6MjA3NzM3NjIxNX0.NZKMBV8WKbef8ADsWAYlgtWlTJsiLqo9T8tjruuy7_k';

        let supabase = null;
        let useLocalStorage = true;

        if (SUPABASE_URL !== 'YOUR_SUPABASE_URL_HERE' && SUPABASE_KEY !== 'YOUR_SUPABASE_ANON_KEY_HERE') {
            try {
                // Initialize Supabase Client
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                useLocalStorage = false;
            } catch (e) {
                console.log('Supabase initialization failed. Using local storage mode.');
            }
        }

        const app = {
            currentView: 'welcome',
            // Default selected period, will be used to filter dates
            selectedPeriod: 'jul-sep-2025',
            showModal: false,
            selectedSlot: null,
            volunteerName: '',
            volunteerEmail: '',
            signups: {},

            periods: [
                { id: 'jan-mar-2025', label: 'January - March 2025', start: '2025-01-01' },
                { id: 'apr-jun-2025', label: 'April - June 2025', start: '2025-04-01' },
                { id: 'jul-sep-2025', label: 'July - September 2025', start: '2025-07-03' }, // Set to a Thursday start for Thursday/Saturday view
                { id: 'oct-dec-2025', label: 'October - December 2025', start: '2025-10-02' },
            ],

            roles: {
                'thursday-hall': [
                    { id: 'managers', name: 'Managers', time: '9:45am-1:30pm', capacity: 2, note: 'Kitchen & Front of House' },
                    { id: 'hall-help', name: 'Hall Help', time: '10:00am-1:30pm', capacity: 5 },
                    { id: 'drinks', name: 'Drinks Trolley', time: '11:15am-1:30pm', capacity: 1 },
                    { id: 'dishes', name: 'Dishes', time: '11:30am-1:30pm', capacity: 1 },
                    { id: 'laundry', name: 'Laundry', time: 'Various', capacity: 1 },
                ],
                'saturday-hall': [
                    { id: 'managers', name: 'Managers', time: '2:45pm-6:30pm', capacity: 2, note: 'Kitchen & Front of House' },
                    { id: 'hall-help', name: 'Hall Help', time: '3:15pm-6:30pm', capacity: 5 },
                    { id: 'drinks', name: 'Drinks Trolley', time: '4:00pm-6:30pm', capacity: 1 },
                    { id: 'dishes', name: 'Dishes', time: '4:30pm-6:30pm', capacity: 1 },
                    { id: 'laundry', name: 'Laundry', time: 'Various', capacity: 1 },
                ],
                'weekly-tasks': [
                    { id: 'wed-pickup', name: 'Wednesday Bakers Delight Pick Up', time: 'Around 3:45pm', capacity: 1 },
                    { id: 'thurs-pickup', name: 'Thursday Bakers Delight Pick Up', time: '4:50pm', capacity: 1 },
                    { id: 'cheesecake', name: 'Cheesecake Shop', time: '3-6pm', capacity: 1 },
                ]
            },

            // --- CORE APP METHODS ---

            async init() {
                await this.loadSignups();
                this.render();
                this.attachEventListeners(); // Attach event listeners after initial render

                if (!useLocalStorage && supabase) {
                    // Set up Supabase Realtime subscription
                    supabase.channel('signups').on('postgres_changes', 
                        { event: '*', schema: 'public', table: 'volunteer_signups' }, 
                        () => this.loadSignups()
                    ).subscribe();
                }
            },

            attachEventListeners() {
                // Use event delegation for buttons inside the app container
                document.getElementById('app').addEventListener('click', (event) => {
                    const target = event.target.closest('button, select');

                    if (!target) return;

                    // Navigation Buttons
                    if (target.dataset.view) {
                        this.currentView = target.dataset.view;
                        this.render();
                    }

                    // Sign Up Button (R
